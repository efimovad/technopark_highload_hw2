# technopark_highload_hw2
## Содержание
- [Оценка аудитории](#оценка-аудитории)
- [Оценка нагрузки](#оценка-нагрузки)
- [Выбор планируемой нагрузки](#выбор-планируемой-нагрузки)
- [Логическая схема базы данных](#логическая-схема-базы-данных)
    * [Пользователи](#пользователи)
    * [Объявления](#объявления)
    * [Сообщения](#сообщения)
- [Физическая система хранения](#физическая-система-хранения)

<!-- toc -->
### Оценка аудитории
Авито ориентирован на Россию. Регистрация происходит по номеру телефона.  
| Население России | Проникновение интернета, 2019 | Проникновение мобильной связи, 2018 | Пользователи Avito в месяц |
|------------------|-------------------------------|-------------------------------------|----------------------------|
| 146,7 млн        | ~116 млн, 80%                 | ~256 млн, 179%                      | 32 млн                     |

Потенциальное максимальное количество аккаунтов на 2018-2019 (если на каждую сим карту - один аккаунт): 
146,7 млн * 0,8 * 1,79 = 210,1 млн

Потенциально проникновение интернета может увеличиться до 100%, но трудно прогнозировать количество сим-карт:
146,7 млн * 1,79 = 262,6 млн

### Оценка нагрузки
| Общее число посещений | Количество страниц на посещение | Время соединения |
|-----------------------|---------------------------------|------------------|
| 229,44 млн            | 12,44                           | 11 минут         |

По данным выше [[1]](https://www.similarweb.com/website/avito.ru): примерно 1 запрос от одного пользователя за минуту.
Тогда среднее rps = 229,44 млн / 60 = 3.824 млн .

| Новых объявлений в день | Новых сделок в минуту |
|-------------------------|-----------------------|
| 400000                  | 120                   |

rps = 400000 / (24 * 60 * 60) + 120 / 60 = 4.6 + 2 = 6.6

Можно заметить, что основную нагрузку составляют просмотр страниц.

### Выбор планируемой нагрузки
Так как с развитием сервиса количество пользователей может увеличиться и максимальная нагрузка может быть в несколько раз больше средней, необходимо ориентироваться на большее значение нагрузки.
### Логическая схема базы данных
#### Пользователи
Таблица **пользователи**
| id  | имя | id города | телефон | ссылка на автар | тип пользователя | дата регистрации |
|-----|-----|-----------|---------|-----------------|------------------|------------------|
|bigint|varchar(30)|int|varchar(11)|varchar(100)|smallint|timestamp|

Одна строка в таблице пользователи занимает 163 байт

**Города** (для экономии памяти добавим таблицу с городами, она будет маленькой (примерно 2386 записей) относительно потенциального количества пользователей и позволит уменьшить количетво используемой памяти)
| id | название |
|----|----------|
|int|varchar(50)|

Одна строка в таблице города занимает 54 байт

#### Объявления
#####  Общие категории 
Для категорий "Личные вещи", "Животные", "Для бизнеса", "Хобби и отдых", "Бытовая электроника", "Для дома и дачи", "Услуги" 
| id     |id пользователя| название    | описание      | id категории | id подкатегории | цена | ссылка на изображение[10] | внешняя ссылка | адрес        | телефон     | почта        | id способа связи | id статуса |
|--------|-------------|---------------|--------------|-----------------|------|---------------------------|----------------|--------------|-------------|--------------|------------------|----|----|
| bigint | bigint | varchar(50) | varchar(5000) | int          | int             | int  | varchar(200)              | varchar(200)   | varchar(150) | varchar(11) | varchar(100) | shortint         | int|

Одна строка в таблице объявления (общие катеригории) занимает 7 345 байт

##### Работа
Раазмещение вакансии  
| id     | id пользователя | название    | график работы | опыт работы | описание      | зарплата | логотип      | адрес        | телефон     | почта        | id способа связи | id статуса |
|--------|-------------|---------------|-------------|---------------|----------|--------------|--------------|-------------|--------------|------------------|----|----|
| bigint | bigint | varchar(50) | shortint      | smalltint    | varchar(5000) | int      | varchar(200) | varchar(150)   | varchar(11) | varchar(100) | shortint         |int |

Одна строка в таблице вакансии (категория работа) занимает 5 549 байт

Размещение резюме
Таблица резюме
| id     | id пользователя | желаемая должность | график работы | стаж     | образование | пол  | возраст  | готов-ть к команд-кам | о себе        | зарплата | фотографии      | адрес        | телефон     | почта        | id способа связи | id статуса |
|--------|--------------------|---------------|----------|-------------|------|----------|-----------------------|---------------|----------|-----------------|--------------|-------------|--------------|------------------|-----|---|
| bigint | bigint | varchar(50)        | smalltint      | smalltint | smalltint    | bool | smalltint | smalltint              | varchar(5000) | int      | varchar(150)[5] | varchar(150) | varchar(11) | varchar(100) | smalltint         |int |

Одна строка в таблице вакансии (категория работа) занимает 5 948 байт

Таблица опыт работы
| id     | id резюме | компания    | должность   | начало работы | конец работы | обязанности  |
|--------|-----------|-------------|-------------|---------------|--------------|--------------|
| bigint | bigint    | varchar(50) | varchar(50) | varchar(15)   | varchar(15)  | varchar(500) |

Одна строка в таблице опыт работы (категория работа) занимает 646 байт

Таблица учебные заведения
| id     | id резюме | название    | специальность | год окончания |
|--------|-----------|-------------|---------------|---------------|
| bigint | bigint    | varchar(50) | varchar(50)   | shortint      |

Одна строка в таблице учебные заведения (категория работа) занимает 118 байт

Таблица знание иностранных языков
| id     | id резюме | id языка | id уровень |
|--------|-----------|----------|------------|
| bigint | bigint    | smalint  | smalint    |

Одна строка в таблице знание иностранных языков занимает 20 байт

##### Недвижимость
Куплю/сниму в категории "квартира", "комната", "дома, дачи, коттеджи" и др.
| id     | id пользователя |  id недвижимости | id длит-ти | id дествия | желаемый район | id города | почта        | телефон     | id типа связи | id параметров | описание      | цена | id статуса |
|--------|-----------------|------------|------------|----------------|-----------|--------------|-------------|---------------|---------------|---------------|------|-----|----|
| bigint | bigint | smalint         | smalint    | smalint    | varchar(100)   | int       | varchar(100) | varchar(11) | smalint       | int           | varchar(5000) | int  | int |

Одна строка в таблице покупка/съем недвижимости занимает 5 251 байт

Продам/сдам в категории "квартира", "комната", "дома, дачи, коттеджи" и др.
| id     | id пользователя | id недвижимости | id дествия | вторичка | id длит-ти | адрес        | собственик | телефон     | id типа связи | номер квартиры | описание      | цена | фотографии       | внешняя ссылка | площадь |id статуса |
|--------|-----------------|------------|----------|------------|--------------|------------|-------------|---------------|----------------|---------------|------|------------------|----------------|---------|-----|----|
| bigint | bigint | smalint         | smalint    | bool     | smalint    | varchar(100) | bool       | varchar(11) | smalint       | smalint        | varchar(5000) | int  | varchar(100)[40] | varchar(500)   | int     | int |

Одна строка в таблице покупка недвижимости занимает 9 651 байт

#### Сообщения
| id     | id отправителя | id получателя | дата отправления | сообщение     |
|--------|----------------|---------------|------------------|---------------|
| bigint | bigint         | bigint        | time             | varchar(5000) |

Одна строка в таблице сообщения занимает 5032 байт

### Физическая система хранения
Текущее количество объявлений: 60 693 348
Так как единстенная функция, которая выводит разные категории товаров - это рекомендации. То отдельные категории можно вынести на отдельные сервисы, но категории "личные вещи" и "транспорт" слишком большие (40.7% и 20.4% от общего числа объявлений), следовательно их тоже необходимо делить.   
![распределение объявлений по категориям](https://sun9-29.userapi.com/c853516/v853516521/2177ae/zSgrvhTuqE8.jpg)  

Также на картинке ниже видно, что практически четверть объявлений приходится на Москву и МО. На Питер и ЛО - 9.3 % объявлений. На остальные крупнейшие города приходится около 1 млн объявлений (примерно 1.7%).  
![распрделение объявлений по городам](https://sun9-70.userapi.com/c857024/v857024392/c7e79/DvMRj0-1CFc.jpg)  
